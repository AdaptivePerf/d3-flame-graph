!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports,require("d3"),require("d3-tip")):"function"==typeof define&&define.amd?define(["exports","d3","d3-tip"],n):n(t.d3=t.d3||{},t.d3)}(this,function(t,n){"use strict";t.flamegraph=function(){var t,e=960,r=null,i=18,a=null,u=!0,o="",c=750,f=n.easeCubic,l=!1,h=!1,d=null,s=0,g=null,p=d3.tip().direction("s").offset([8,0]).attr("class","d3-flame-graph-tip").html(function(t){return y(t)});function v(t){return t.data.n||t.data.name}function m(t){return t.c||t.children}function x(t){return t.v||t.value}var y=function(t){return v(t)+" ("+n.format(".3f")(100*(t.x1-t.x0),3)+"%, "+x(t)+" samples)"};function b(t){g&&(g.innerHTML=t)}var E=function(t){return t.highlight?"#E600E6":function(t){var n=0;if(t){var e=t.split("`");e.length>1&&(t=e[e.length-1]),t=t.split("(")[0],n=function(t){var n=0,e=0,r=1;if(t){for(var i=0;i<t.length&&!(i>6);i++)n+=r*(t.charCodeAt(i)%10),e+=9*r,r*=.7;e>0&&(n/=e)}return n}(t)}var r=200+Math.round(55*n),i=0+Math.round(230*(1-n)),a=0+Math.round(55*(1-n));return"rgb("+r+","+i+","+a+")"}(v(t))};function w(t){t.data.hide=!0,m(t)&&m(t).forEach(w)}function M(t){t.data.fade=!1,t.data.hide=!1,m(t)&&m(t).forEach(M)}function j(t){p.hide(t),function t(n){(function(t){var n=[];if(t.parent){var e=t.parent.children.indexOf(t);(n=t.parent.children.slice(0)).splice(e,1)}return n})(n).forEach(function(t){w(t)}),n.parent&&t(n.parent)}(t),M(t),function t(n){n.parent&&(n.parent.data.fade=!0,t(n.parent))}(t),A(),"function"==typeof d&&d(t)}function O(t,e){return"function"==typeof l?l(t,e):l?n.ascending(v(t),v(e)):void 0}var k=n.partition();function A(){a.each(function(t){var a=n.scaleLinear().range([0,e]),o=n.scaleLinear().range([0,i]);l&&t.sort(O),t.sum(function(t){if(t.fade||t.hide)return 0;var n=x(t);if(m(t))for(var e=m(t),r=0;r<e.length;r++)n-=x(e[r]);return n}),k(t);var d=e/(t.x1-t.x0);function g(t){return(t.x1-t.x0)*d}var w=function(t){var n=t.descendants();if(s>0){var r=e/(t.x1-t.x0);n=n.filter(function(t){return(t.x1-t.x0)*r>s})}return n}(t),M=n.select(this).select("svg").selectAll("g").data(w,function(t){return t.id});M.transition().duration(c).ease(f).attr("transform",function(t){return"translate("+a(t.x0)+","+(h?o(t.depth):r-o(t.depth)-i)+")"}),M.select("rect").attr("width",g);var A=M.enter().append("svg:g").attr("transform",function(t){return"translate("+a(t.x0)+","+(h?o(t.depth):r-o(t.depth)-i)+")"});A.append("svg:rect").transition().delay(c/2).attr("width",g),u||A.append("svg:title"),A.append("foreignObject").append("xhtml:div"),(M=n.select(this).select("svg").selectAll("g").data(w,function(t){return t.id})).attr("width",g).attr("height",function(t){return i}).attr("name",function(t){return v(t)}).attr("class",function(t){return t.data.fade?"frame fade":"frame"}),M.select("rect").attr("height",function(t){return i}).attr("fill",function(t){return E(t)}),u||M.select("title").text(y),M.select("foreignObject").attr("width",g).attr("height",function(t){return i}).select("div").attr("class","d3-flame-graph-label").style("display",function(t){return g(t)<35?"none":"block"}).transition().delay(c).text(v),M.on("click",j),M.exit().remove(),M.on("mouseover",function(t){u&&p.show(t),b(y(t))}).on("mouseout",function(t){u&&p.hide(t),b("")})})}function C(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function L(t){t.id=C()+"-"+C()+"--"+C()+"-"+C();for(var n=t.c||t.children||[],e=0;e<n.length;e++)L(n[e])}function q(u){var c=n.hierarchy(u.datum(),function(t){return m(t)});if(L(c),a=u.datum(c),!arguments.length)return q;r||(r=(c.height+2)*i),a.each(function(i){t||(t=n.select(this).append("svg:svg").attr("width",e).attr("height",r).attr("class","partition d3-flame-graph").call(p)).append("svg:text").attr("class","title").attr("text-anchor","middle").attr("y","25").attr("x",e/2).attr("fill","#808080").text(o)}),A()}return q.height=function(t){return arguments.length?(r=t,q):r},q.width=function(t){return arguments.length?(e=t,q):e},q.cellHeight=function(t){return arguments.length?(i=t,q):i},q.tooltip=function(t){return arguments.length?("function"==typeof t&&(p=t),u=!!t,q):u},q.title=function(t){return arguments.length?(o=t,q):o},q.transitionDuration=function(t){return arguments.length?(c=t,q):c},q.transitionEase=function(t){return arguments.length?(f=t,q):f},q.sort=function(t){return arguments.length?(l=t,q):l},q.inverted=function(t){return arguments.length?(h=t,q):h},q.label=function(t){return arguments.length?(y=t,q):y},q.search=function(t){var n=[];return a.each(function(e){n=function(t,n){var e=new RegExp(n),r=[];return function t(n){var i=v(n);m(n)&&m(n).forEach(function(n){t(n)}),i.match(e)?(n.highlight=!0,r.push(n)):n.highlight=!1}(t),r}(e,t),A()}),n},q.clear=function(){a.each(function(t){!function t(n){n.highlight=!1,m(n)&&m(n).forEach(function(n){t(n)})}(t),A()})},q.zoomTo=function(t){j(t)},q.resetZoom=function(){a.each(function(t){j(t)})},q.onClick=function(t){return arguments.length?(d=t,q):d},q.merge=function(t){var e;a.each(function(r){!function t(n,e){e.forEach(function(e){var r=n.find(function(t){return t.name===e.name});r?(r.original?r.original+=e.value:r.value+=e.value,e.children&&(r.children||(r.children=[]),t(r.children,e.children))):n.push(e)})}([r.data],[t]),L(e=n.hierarchy(r.data,function(t){return m(t)}))}),a=a.datum(e),A()},q.color=function(t){return arguments.length?(E=t,q):E},q.minFrameSize=function(t){return arguments.length?(s=t,q):s},q.details=function(t){return arguments.length?(g=t,q):g},q},Object.defineProperty(t,"__esModule",{value:!0})});